<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Michael D. Sumner" />

<meta name="date" content="2024-08-17" />

<title>NetCDF with tidync</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">NetCDF with tidync</h1>
<h4 class="author">Michael D. Sumner</h4>
<h4 class="date">2024-08-17</h4>



<p>The goal of tidync is to ease exploring the contents of a NetCDF
source and to simplify the process of data extraction.</p>
<p>Array dimension expressions virtually <em>slice</em>
(i.e. <em>index</em>) into data arrays with immediate feedback, and ease
programming for automating data extraction. No data is read until
explicitly requested, and can be pulled directly as an array, or in
long-form as a data frame.</p>
<p>NetCDF is <strong>Network Common Data Form</strong>, a <a href="https://twitter.com/TedHabermann/status/958034585002041344">data
model</a> and an <a href="https://en.wikipedia.org/wiki/Application_programming_interface">API</a>.</p>
<p>This is a very common, and <em>very general</em> way to store and
work with scientific array-based data. NetCDF is defined and provided by
<a href="https://www.unidata.ucar.edu/software/netcdf/">Unidata</a>.</p>
<p>Here we introduce traditional concepts of NetCDF, and show examples
with built-in files and online sources to demonstrate tidync
functionality.</p>
<div id="netcdf" class="section level1">
<h1>NetCDF</h1>
<p>NetCDF is a very widely used file format for storing array-based data
as <em>variables</em>. The <strong>space</strong> occupied by a
<strong>variable</strong> is defined by its <strong>dimensions</strong>
and their metadata. Dimensions are by definition
<em>one-dimensional</em> (i.e. an atomic vector in R of length 1 or
more), an array with coordinate metadata, units, type and
interpretation. The <strong>space</strong> of a variable is defined as
one or more of the dimensions in the file. A given variable won’t
necessarily use all the available dimensions and no dimensions are
mandatory or particularly special.</p>
<p>Some conventions exist to define usage and minimal standards for
metadata for particular file schemas, but these are many and varied, and
not always adhered to. Tidync does not provide a data interpretation as
it is intended for general use, including by tools that create data
formats.</p>
<p>The R community is not particularly strong with use of NetCDF, though
it is common and widely used it pales compared to use in general climate
science work, and there the most used tool is the <a href="https://code.mpimet.mpg.de/projects/cdo">CDO Climate Data
Operators</a>. In R the most common tools used are ncdf4 and raster
(which uses ncdf4).</p>
<p>Both the RNetCDF and ncdf4 packages provide a traditional summary
format, familiar to many NetCDF users as the output of the command line
program <a href="https://www.unidata.ucar.edu/software/netcdf/workshops/most-recent/utilities/Ncdump.html"><code>ncdump</code></a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>ice_file <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;ifremer&quot;</span>, <span class="st">&quot;20171002.nc&quot;</span>, <span class="at">package =</span> <span class="st">&quot;tidync&quot;</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(RNetCDF)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">print.nc</span>(<span class="fu">open.nc</span>(ice_file))</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt; netcdf classic {</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt; dimensions:</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#&gt;  ni = 632 ;</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt;  nj = 664 ;</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt;  time = 1 ;</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; variables:</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt;  NC_INT time(time) ;</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR time:long_name = &quot;time&quot; ;</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR time:units = &quot;hours since 1900-1-1 0:0:0&quot; ;</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt;  NC_BYTE concentration(ni, nj, time) ;</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR concentration:long_name = &quot;sea-ice concentration&quot; ;</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR concentration:units = &quot;percent&quot; ;</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co">#&gt;      NC_DOUBLE concentration:scale_factor = 1 ;</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co">#&gt;      NC_DOUBLE concentration:add_offset = 0 ;</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co">#&gt;      NC_BYTE concentration:missing_value = -128 ;</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co">#&gt;      NC_BYTE concentration:_FillValue = -128 ;</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">#&gt;  NC_BYTE quality_flag(ni, nj, time) ;</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR quality_flag:long_name = &quot;quality_flag&quot; ;</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR quality_flag:units = &quot;n/a&quot; ;</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co">#&gt;      NC_DOUBLE quality_flag:scale_factor = 1 ;</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co">#&gt;      NC_DOUBLE quality_flag:add_offset = 0 ;</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="co">#&gt;      NC_BYTE quality_flag:missing_value = -128 ;</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="co">#&gt;      NC_BYTE quality_flag:_FillValue = -128 ;</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co">#&gt; // global attributes:</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :CONVENTIONS = &quot;COARDS&quot; ;</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :long_name = &quot;Sea-ice concentration as observed by SSM/I&quot; ;</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :short_name = &quot;PSI-F18-Concentration&quot; ;</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :producer_agency = &quot;IFREMER&quot; ;</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :producer_institution = &quot;CERSAT&quot; ;</span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :netcdf_version_id = &quot;3.4&quot; ;</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :product_version = &quot;2.0&quot; ;</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :creation_time = &quot;2017-280T08:26:34.000&quot; ;</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :time_resolution = &quot;daily&quot; ;</span></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :grid = &quot;NSIDC&quot; ;</span></span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :pole = &quot;south&quot; ;</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :spatial_resolution = &quot;12.5 km&quot; ;</span></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :platform_id = &quot;F18&quot; ;</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a><span class="co">#&gt;      NC_CHAR :instrument = &quot;SSM/I&quot; ;</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>Using <code>ncdump</code> at the command line on a suitable system
would yield very similar output to the print above.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">ncdump</span> <span class="at">-h</span> /path/to/extdata/ifremer/20171002.nc</span></code></pre></div>
<p>With the ncdf4 package it’s a slightly different approach, but gives
the same result.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">print</span>(ncdf4<span class="sc">::</span><span class="fu">nc_open</span>(ice_file))</span></code></pre></div>
<p>Notice how the listing above is organized by <em>dimension</em> and
then by <em>variable</em>. It’s not particularly obvious that some
variables are defined within the same set of dimensions as others.</p>
<p>A NetCDF file is a container for simple array based data structures.
There is limited capacity <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> in the formal API for accessing data
randomly within a variable, the primary mechanism is to define offset
and stride (start and count) hyperslab indexes.</p>
<div id="tidync" class="section level2">
<h2>tidync</h2>
<p>Tidync aims to ease exploration of the contents of a NetCDF file and
provides methods extract arbitrary hyperslabs. These can be used
directly in array contexts, or in “long form” database contexts.</p>
<p>On first contact with the file, the available variables are
classified by grid and dimension. The “active” grid is the one that
queries may be made against, and may be changed with the
<code>activate</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(tidync)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">tidync</span>(ice_file)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag    **ACTIVE GRID** ( 419648  values per variable)</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (all active): </span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632       1     632     1   632       1     632 FALSE FALSE     </span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664       1     664     1   664       1     664 FALSE FALSE     </span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; 3 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE</span></span></code></pre></div>
<p>Here we see variables are clearly grouped by the <em>grid</em> they
exist in, where grid is a specific (and ordered!) set of dimensions.
This allows us to see the set of variables that implicitly co-exist,
they have the same <em>shape</em>. The first grid “D0,D1,D2” has two
variables, <em>concentration</em> and <em>quality_flag</em>, and the
second “D2” has only one variable <em>time</em>. There are no general
rules here, a file might have any number of dimensions and variables,
and any variable might be defined by one or more dimensions.</p>
<p>In this case the D2 grid has only one variable in its single
dimension, and it happens to be a special kind of variable - a
“coordinate dimension”, as indicated by the <code>coord_dim</code> flag.
In the traditional <code>ncdump</code> summary above it’s easy to see
there’s only really one data grid, in <code>ni,nj,time</code> that it
holds two variables, and that time is a special coordinate dimension -
in contrast neither <code>ni</code> or <code>nj</code> have an explicit
1-dimension variable. When there are many dimensions and/or many
variables those patterns are <em>not</em> easy to see.</p>
<p>A particular grid was chosen by default, this is the “D0,D1,D2” grid
composed of 3 dimensions, generally the largest grid will be chosen as
that is <em>usually</em> the target we would be after. To choose a
different grid we may nominate it by name, or by member variable.</p>
<p>By name we choose a grid composed of only one dimension, and the
summary print makes a distinction based on which dimensions are
<em>active</em>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">tidync</span>(ice_file) <span class="sc">%&gt;%</span> <span class="fu">activate</span>(<span class="st">&quot;D2&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time    **ACTIVE GRID** ( 1  value per variable)</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (1 active): </span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; 1 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE      </span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; Inactive dimensions:</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt;   dim   name  length   min   max unlim coord_dim </span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632     1   632 FALSE FALSE     </span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664     1   664 FALSE FALSE</span></span></code></pre></div>
<p>It is also possible to choose a grid by <em>variable name</em>. If we
choose a variable in the default grid, then it’s no different to the
first case.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">tidync</span>(ice_file) <span class="sc">%&gt;%</span> <span class="fu">activate</span>(<span class="st">&quot;time&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time    **ACTIVE GRID** ( 1  value per variable)</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (1 active): </span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; 1 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE      </span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; Inactive dimensions:</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt;   dim   name  length   min   max unlim coord_dim </span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632     1   632 FALSE FALSE     </span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664     1   664 FALSE FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="do">## choose grid by variable name, which happens to be the default grid here</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">tidync</span>(ice_file) <span class="sc">%&gt;%</span> <span class="fu">activate</span>(<span class="st">&quot;quality_flag&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag    **ACTIVE GRID** ( 419648  values per variable)</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (all active): </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632       1     632     1   632       1     632 FALSE FALSE     </span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664       1     664     1   664       1     664 FALSE FALSE     </span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; 3 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="do">## same as the default</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">tidync</span>(ice_file) <span class="sc">%&gt;%</span> <span class="fu">activate</span>(<span class="st">&quot;D0,D1,D2&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag    **ACTIVE GRID** ( 419648  values per variable)</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (all active): </span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632       1     632     1   632       1     632 FALSE FALSE     </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664       1     664     1   664       1     664 FALSE FALSE     </span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; 3 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE</span></span></code></pre></div>
<p>The data variables available on a grid can be expanded out as a
single data frame, which all the coordinates copied out - this is not
efficient(!) but if we craft our queries sensibly to read only what we
need, it’s a very easy way to explore the data in a file.</p>
<p>The ‘hyper_filter’ function allows specification of expressions to
subset a variable based on each dimension’s coordinate values.</p>
<p>If no expressions are included we are presented with a table
containing a row for each dimension, its extent in coordinates and its
length. For convenience we also assign the activate form to an R
variable, though we could just chain the entire operation without
this.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>concentration <span class="ot">&lt;-</span> <span class="fu">tidync</span>(ice_file) </span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>concentration <span class="sc">%&gt;%</span> <span class="fu">hyper_filter</span>() </span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag    **ACTIVE GRID** ( 419648  values per variable)</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (all active): </span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632       1     632     1   632       1     632 FALSE FALSE     </span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664       1     664     1   664       1     664 FALSE FALSE     </span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; 3 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE</span></span></code></pre></div>
<p>By specifying inequality expressions we see an <em>implicit</em>
subsetting of the array. Everything so far is implicit to delay any
file-based computation required to actually interact with the file and
read from it.</p>
<p>Notice that these are “name = expr” paired expressions, because the
right hand side may be quite general we need the left hand side name to
be assured of the name of the dimension referred to.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>concentration <span class="sc">%&gt;%</span> <span class="fu">hyper_filter</span>(<span class="at">nj =</span> nj <span class="sc">&lt;</span> <span class="dv">20</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag    **ACTIVE GRID** ( 419648  values per variable)</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (all active): </span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632       1     632     1   632       1     632 FALSE FALSE     </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664       1     664     1    19       1      19 FALSE FALSE     </span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; 3 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE</span></span></code></pre></div>
<p>We can also use the special internal variable ‘index’, which will
test against position in the dimension elements ‘1:length’ rather than
the values. It’s not different in this case because ni and nj are just
position dimensions anyway. The special ‘dplyr’ adverbs like ‘between’
will work.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>concentration <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="fu">hyper_filter</span>(<span class="at">ni =</span> index <span class="sc">&lt;</span> <span class="dv">50</span>, </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>               <span class="at">nj =</span> dplyr<span class="sc">::</span><span class="fu">between</span>(index, <span class="dv">30</span>, <span class="dv">100</span>))</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag    **ACTIVE GRID** ( 419648  values per variable)</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (all active): </span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632       1     632     1    49       1      49 FALSE FALSE     </span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664       1     664    30    71      30     100 FALSE FALSE     </span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; 3 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE</span></span></code></pre></div>
</div>
<div id="data-extraction" class="section level2">
<h2>Data extraction</h2>
<p>How to use these idioms to extract actual data?</p>
<p>We can now exercise these variable choice and dimension filters to
return actual data, either in by slicing out a “slab” in array-form, or
as a data frame.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>hf <span class="ot">&lt;-</span> concentration <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">hyper_filter</span>(<span class="at">ni =</span> index <span class="sc">&gt;</span> <span class="dv">150</span>, </span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>               <span class="at">nj =</span> dplyr<span class="sc">::</span><span class="fu">between</span>(index, <span class="dv">30</span>, <span class="dv">100</span>))</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="do">## as an array</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>arr <span class="ot">&lt;-</span> hf <span class="sc">%&gt;%</span> <span class="fu">hyper_array</span>()</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="fu">str</span>(arr)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt;  $ concentration: int [1:482, 1:71] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;dimnames&quot;)=List of 2</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt;   .. ..$ ni: chr [1:482] &quot;151&quot; &quot;152&quot; &quot;153&quot; &quot;154&quot; ...</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt;   .. ..$ nj: chr [1:71] &quot;30&quot; &quot;31&quot; &quot;32&quot; &quot;33&quot; ...</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt;  $ quality_flag : int [1:482, 1:71] 8 8 8 8 8 8 8 8 8 8 ...</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;dimnames&quot;)=List of 2</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt;   .. ..$ ni: chr [1:482] &quot;151&quot; &quot;152&quot; &quot;153&quot; &quot;154&quot; ...</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt;   .. ..$ nj: chr [1:71] &quot;30&quot; &quot;31&quot; &quot;32&quot; &quot;33&quot; ...</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;transforms&quot;)=List of 3</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt;   ..$ ni  : tibble [632 × 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt;   .. ..$ ni       : int [1:632] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co">#&gt;   .. ..$ index    : int [1:632] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="co">#&gt;   .. ..$ id       : int [1:632] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="co">#&gt;   .. ..$ name     : chr [1:632] &quot;ni&quot; &quot;ni&quot; &quot;ni&quot; &quot;ni&quot; ...</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="co">#&gt;   .. ..$ coord_dim: logi [1:632] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="co">#&gt;   .. ..$ selected : logi [1:632] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="co">#&gt;   ..$ nj  : tibble [664 × 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="co">#&gt;   .. ..$ nj       : int [1:664] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="co">#&gt;   .. ..$ index    : int [1:664] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="co">#&gt;   .. ..$ id       : int [1:664] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="co">#&gt;   .. ..$ name     : chr [1:664] &quot;nj&quot; &quot;nj&quot; &quot;nj&quot; &quot;nj&quot; ...</span></span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a><span class="co">#&gt;   .. ..$ coord_dim: logi [1:664] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a><span class="co">#&gt;   .. ..$ selected : logi [1:664] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a><span class="co">#&gt;   ..$ time: tibble [1 × 7] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a><span class="co">#&gt;   .. ..$ time     : num 1032204</span></span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a><span class="co">#&gt;   .. ..$ timestamp: chr &quot;2017-10-02 12:00:00&quot;</span></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a><span class="co">#&gt;   .. ..$ index    : int 1</span></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a><span class="co">#&gt;   .. ..$ id       : int 2</span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a><span class="co">#&gt;   .. ..$ name     : chr &quot;time&quot;</span></span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a><span class="co">#&gt;   .. ..$ coord_dim: logi TRUE</span></span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a><span class="co">#&gt;   .. ..$ selected : logi TRUE</span></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;source&quot;)= tibble [1 × 2] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a><span class="co">#&gt;   ..$ access: POSIXct[1:1], format: &quot;2024-08-17 07:40:55&quot;</span></span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a><span class="co">#&gt;   ..$ source: chr &quot;/perm_storage/home/data/r_tmp/Rtmputcyix/Rinstf97e4af6ccc8/tidync/extdata/ifremer/20171002.nc&quot;</span></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;class&quot;)= chr &quot;tidync_data&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="do">## as a data frame</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>hf <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="fu">hyper_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(concentration)) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(concentration, quality_flag)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; # A tibble: 105 × 2</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt;    concentration quality_flag</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt;            &lt;int&gt;        &lt;int&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt;  1             0            0</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt;  2             0           12</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt;  3            42            0</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt;  4            20            0</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt;  5            21            0</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt;  6            55            0</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt;  7            17            0</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt;  8            64            0</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#&gt;  9            25            0</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt; 10            23            0</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#&gt; # ℹ 95 more rows</span></span></code></pre></div>
</div>
<div id="interrogating-data-by-dimensions" class="section level2">
<h2>Interrogating data by dimensions</h2>
<p>The connection object ‘hf’ is available for determining what is
available and how we might cut into it. ‘time’ interestingly is of
length 1, so perhaps adds nothing to the information about this
otherwise 2D data set. If we were to open this file in
<code>ncdf4</code> or <code>RNetCDF</code> and wanted to take a subset
of the file out, we would have to specify and <code>start</code> of 1
and a <code>count</code> of ` even though it’s completely redundant.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>hf</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag    **ACTIVE GRID** ( 419648  values per variable)</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (all active): </span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632       1     632   151   482     151     632 FALSE FALSE     </span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664       1     664    30    71      30     100 FALSE FALSE     </span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt; 3 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE</span></span></code></pre></div>
<p>The ‘start’ and ‘count’ values reported are directly useable by the
traditional API tools, and in particular by the functions
<code>ncdf4::ncvar_get()</code> (<code>varid</code>, <code>start</code>,
<code>count</code>), its counterpart in
<code>RNetCDF::var.get.nc()</code> and command line tools like CDO.</p>
<p>But, it’s a pain to have to know the dimension of the variable and
specify every slot. Code in the traditional API that looks like this</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">## </span><span class="al">WARNING</span><span class="do">, pseudocode</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">var_get</span>(con, variable, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">count =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">1</span>))</span></code></pre></div>
<p>Obviously, it should be reasonable to specify only the count of any
dimensions that <em>we don’t want the entirety of</em>. This problem
manifests exactly in R arrays generally, we can’t provide information
only about the dimensions we want, they have to be specified explicitly
- even if we mean <em>all of it</em>.</p>
<p>It does not matter what we include in the filter query, it can be
all, some or none of the available dimensions, in any order.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>hf <span class="sc">%&gt;%</span> <span class="fu">hyper_filter</span>(<span class="at">nj =</span> index <span class="sc">&lt;</span> <span class="dv">20</span>, <span class="at">ni =</span> ni <span class="sc">&gt;</span> <span class="dv">20</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag    **ACTIVE GRID** ( 419648  values per variable)</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (all active): </span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632       1     632    21   612      21     632 FALSE FALSE     </span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664       1     664     1    19       1      19 FALSE FALSE     </span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt; 3 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>hf <span class="sc">%&gt;%</span> <span class="fu">hyper_filter</span>(<span class="at">nj =</span> index <span class="sc">&lt;</span> <span class="dv">20</span>)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; Data Source (1): 20171002.nc ...</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt; Grids (2) &lt;dimension family&gt; : &lt;associated variables&gt; </span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; [1]   D0,D1,D2 : concentration, quality_flag    **ACTIVE GRID** ( 419648  values per variable)</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt; [2]   D2       : time</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; Dimensions 3 (all active): </span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt;   dim   name  length     min     max start count    dmin    dmax unlim coord_dim </span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     </span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt; 1 D0    ni       632       1     632   151   482     151     632 FALSE FALSE     </span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt; 2 D1    nj       664       1     664     1    19       1      19 FALSE FALSE     </span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co">#&gt; 3 D2    time       1 1032204 1032204     1     1 1032204 1032204 FALSE TRUE</span></span></code></pre></div>
<p>The other requirement we have is the ability to automate these task,
and so far we have only interacted with the dimensionality information
from the print out. For programming, there are functions
<code>hyper_vars()</code>, <code>hyper_dims()</code> and
<code>hyper_grids()</code> to report on elements in the source. The
value of <code>hyper_vars()</code> and <code>hyper_dims()</code> is
restricted to the <em>active</em> grid. The function
<code>hyper_grids()</code> reports all available grids, with the
currently active one indicated. The name of the current grid is also
available via <code>active()</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">hyper_vars</span>(hf)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co">#&gt;      id name          type    ndims natts dim_coord</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;lgl&gt;    </span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co">#&gt; 1     1 concentration NC_BYTE     3     6 FALSE    </span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#&gt; 2     2 quality_flag  NC_BYTE     3     6 FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">hyper_dims</span>(hf)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 7</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt;   name  length start count    id unlim coord_dim</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;lgl&gt; &lt;lgl&gt;    </span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; 1 ni       632   151   482     0 FALSE FALSE    </span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; 2 nj       664    30    71     1 FALSE FALSE    </span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; 3 time       1     1     1     2 FALSE TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="do">## change the active grid</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>hf <span class="sc">%&gt;%</span> <span class="fu">activate</span>(<span class="st">&quot;D2&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="fu">hyper_vars</span>()</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt;      id name  type   ndims natts dim_coord</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;lgl&gt;    </span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt; 1     0 time  NC_INT     1     2 TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">active</span>(hf)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;D0,D1,D2&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>hf <span class="sc">%&gt;%</span> <span class="fu">activate</span>(<span class="st">&quot;D2&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="fu">active</span>()</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;D2&quot;</span></span></code></pre></div>
</div>
<div id="transforms" class="section level2">
<h2>Transforms</h2>
<p>Under the hood tidync manages the relationship between dimensions and
coordinates via <em>transforms</em> tables. This is a 1-dimensional
mapping between dimension index and its coordinate value (if there’s no
explicit value it is assumed to be equal to the 1-based index). These
tables are available via the <code>hyper_transforms()</code>
function.</p>
<p>Each table has columns <code>&lt;dimension-name&gt;</code>,
<code>index</code>, <code>id</code>, <code>name</code>,
<code>coord_dim</code> (whether the dimension has explicit coordinates,
in the <code>&lt;dimension-name&gt;</code> column), and
<code>selected</code>. The <code>selected</code> column records which of
the dimension elements is currently requested by a
<code>hyper_filter</code> query, and by default is set to
<code>TRUE</code>. Expressions in the filter function work by updating
this column.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">hyper_transforms</span>(hf)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="co">#&gt; $ni</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co">#&gt; # A tibble: 632 × 6</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">#&gt;       ni index    id name  coord_dim selected</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;lgl&gt;     &lt;lgl&gt;   </span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co">#&gt;  1     1     1     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="co">#&gt;  2     2     2     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="co">#&gt;  3     3     3     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co">#&gt;  4     4     4     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">#&gt;  5     5     5     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="co">#&gt;  6     6     6     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="co">#&gt;  7     7     7     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="co">#&gt;  8     8     8     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a><span class="co">#&gt;  9     9     9     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="co">#&gt; 10    10    10     0 ni    FALSE     FALSE   </span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a><span class="co">#&gt; # ℹ 622 more rows</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a><span class="co">#&gt; $nj</span></span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a><span class="co">#&gt; # A tibble: 664 × 6</span></span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a><span class="co">#&gt;       nj index    id name  coord_dim selected</span></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;lgl&gt;     &lt;lgl&gt;   </span></span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a><span class="co">#&gt;  1     1     1     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a><span class="co">#&gt;  2     2     2     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a><span class="co">#&gt;  3     3     3     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a><span class="co">#&gt;  4     4     4     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a><span class="co">#&gt;  5     5     5     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a><span class="co">#&gt;  6     6     6     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a><span class="co">#&gt;  7     7     7     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a><span class="co">#&gt;  8     8     8     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a><span class="co">#&gt;  9     9     9     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a><span class="co">#&gt; 10    10    10     1 nj    FALSE     FALSE   </span></span>
<span id="cb23-32"><a href="#cb23-32" tabindex="-1"></a><span class="co">#&gt; # ℹ 654 more rows</span></span>
<span id="cb23-33"><a href="#cb23-33" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb23-34"><a href="#cb23-34" tabindex="-1"></a><span class="co">#&gt; $time</span></span>
<span id="cb23-35"><a href="#cb23-35" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 7</span></span>
<span id="cb23-36"><a href="#cb23-36" tabindex="-1"></a><span class="co">#&gt;      time timestamp           index    id name  coord_dim selected</span></span>
<span id="cb23-37"><a href="#cb23-37" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt; &lt;chr&gt;               &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;lgl&gt;     &lt;lgl&gt;   </span></span>
<span id="cb23-38"><a href="#cb23-38" tabindex="-1"></a><span class="co">#&gt; 1 1032204 2017-10-02 12:00:00     1     2 time  TRUE      TRUE</span></span></code></pre></div>
</div>
<div id="future-improvements" class="section level2">
<h2>Future improvements</h2>
<ul>
<li>support multiple sources at once for lazy read of a virtual
grid</li>
<li>support groups</li>
<li>support compound types</li>
<li>allow a group-by function for a polygon layer, against a pair of
dimensions to classify cells</li>
<li>allow a truly DBI and dplyr level of lazy read, with more filter,
select, mutate and collect idioms</li>
<li>provide converters to raster format, stars format</li>
</ul>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>I.e. it’s not possible to query a file for an arbitrary
sparse set of values, without constructing a degenerate hyperslab query
for each point or reading a hyperslab containing cells not in the set.
Do you know different? Please let me know!<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
